{"ast":null,"code":"import axios from 'axios';\nimport { getLogger } from '../core';\nconst log = getLogger('stockApi');\nconst baseUrl = 'localhost:3000';\nconst carsUrl = `http://${baseUrl}/car`;\n\nfunction withLogs(promise, fnName) {\n  log(`${fnName} - started`);\n  return promise.then(res => {\n    log(`${fnName} - succeeded`);\n    return Promise.resolve(res.data);\n  }).catch(err => {\n    log(`${fnName} - failed`);\n    return Promise.reject(err);\n  });\n}\n\nconst config = {\n  headers: {\n    'Content-Type': 'application/json'\n  }\n};\nexport const getCars = () => {\n  return withLogs(axios.get(carsUrl, config), 'getCars');\n};\nexport const createCar = stock => {\n  return withLogs(axios.post(carsUrl, stock, config), 'createCar');\n};\nexport const updateCar = stock => {\n  return withLogs(axios.put(`${carsUrl}/${stock.id}`, stock, config), 'updateCar');\n};\nexport const newWebSocket = onMessage => {\n  const ws = new WebSocket(`ws://${baseUrl}`);\n\n  ws.onopen = () => {\n    log('web socket onopen');\n  };\n\n  ws.onclose = () => {\n    log('web socket onclose');\n  };\n\n  ws.onerror = error => {\n    log('web socket onerror', error);\n  };\n\n  ws.onmessage = messageEvent => {\n    log('web socket onmessage');\n    onMessage(JSON.parse(messageEvent.data));\n  };\n\n  return () => {\n    ws.close();\n  };\n};","map":{"version":3,"sources":["C:/Users/Andrei Gabor/Desktop/UNI/3rd YEAR/Mobile/filip/stocks-app/src/cars/StockApi.tsx"],"names":["axios","getLogger","log","baseUrl","carsUrl","withLogs","promise","fnName","then","res","Promise","resolve","data","catch","err","reject","config","headers","getCars","get","createCar","stock","post","updateCar","put","id","newWebSocket","onMessage","ws","WebSocket","onopen","onclose","onerror","error","onmessage","messageEvent","JSON","parse","close"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,SAAT,QAA0B,SAA1B;AAGA,MAAMC,GAAG,GAAGD,SAAS,CAAC,UAAD,CAArB;AAEA,MAAME,OAAO,GAAG,gBAAhB;AACA,MAAMC,OAAO,GAAI,UAASD,OAAQ,MAAlC;;AAMA,SAASE,QAAT,CAAqBC,OAArB,EAAyDC,MAAzD,EAAqF;AACnFL,EAAAA,GAAG,CAAE,GAAEK,MAAO,YAAX,CAAH;AACA,SAAOD,OAAO,CACXE,IADI,CACCC,GAAG,IAAI;AACXP,IAAAA,GAAG,CAAE,GAAEK,MAAO,cAAX,CAAH;AACA,WAAOG,OAAO,CAACC,OAAR,CAAgBF,GAAG,CAACG,IAApB,CAAP;AACD,GAJI,EAKJC,KALI,CAKEC,GAAG,IAAI;AACZZ,IAAAA,GAAG,CAAE,GAAEK,MAAO,WAAX,CAAH;AACA,WAAOG,OAAO,CAACK,MAAR,CAAeD,GAAf,CAAP;AACD,GARI,CAAP;AASD;;AAED,MAAME,MAAM,GAAG;AACbC,EAAAA,OAAO,EAAE;AACP,oBAAgB;AADT;AADI,CAAf;AAMA,OAAO,MAAMC,OAAkC,GAAG,MAAM;AACtD,SAAOb,QAAQ,CAACL,KAAK,CAACmB,GAAN,CAAUf,OAAV,EAAmBY,MAAnB,CAAD,EAA6B,SAA7B,CAAf;AACD,CAFM;AAIP,OAAO,MAAMI,SAAmD,GAAGC,KAAK,IAAI;AAC1E,SAAOhB,QAAQ,CAACL,KAAK,CAACsB,IAAN,CAAWlB,OAAX,EAAoBiB,KAApB,EAA2BL,MAA3B,CAAD,EAAqC,WAArC,CAAf;AACD,CAFM;AAIP,OAAO,MAAMO,SAAmD,GAAGF,KAAK,IAAI;AAC1E,SAAOhB,QAAQ,CAACL,KAAK,CAACwB,GAAN,CAAW,GAAEpB,OAAQ,IAAGiB,KAAK,CAACI,EAAG,EAAjC,EAAoCJ,KAApC,EAA2CL,MAA3C,CAAD,EAAqD,WAArD,CAAf;AACD,CAFM;AAWP,OAAO,MAAMU,YAAY,GAAIC,SAAD,IAA4C;AACtE,QAAMC,EAAE,GAAG,IAAIC,SAAJ,CAAe,QAAO1B,OAAQ,EAA9B,CAAX;;AACAyB,EAAAA,EAAE,CAACE,MAAH,GAAY,MAAM;AAChB5B,IAAAA,GAAG,CAAC,mBAAD,CAAH;AACD,GAFD;;AAGA0B,EAAAA,EAAE,CAACG,OAAH,GAAa,MAAM;AACjB7B,IAAAA,GAAG,CAAC,oBAAD,CAAH;AACD,GAFD;;AAGA0B,EAAAA,EAAE,CAACI,OAAH,GAAaC,KAAK,IAAI;AACpB/B,IAAAA,GAAG,CAAC,oBAAD,EAAuB+B,KAAvB,CAAH;AACD,GAFD;;AAGAL,EAAAA,EAAE,CAACM,SAAH,GAAeC,YAAY,IAAI;AAC7BjC,IAAAA,GAAG,CAAC,sBAAD,CAAH;AACAyB,IAAAA,SAAS,CAACS,IAAI,CAACC,KAAL,CAAWF,YAAY,CAACvB,IAAxB,CAAD,CAAT;AACD,GAHD;;AAIA,SAAO,MAAM;AACXgB,IAAAA,EAAE,CAACU,KAAH;AACD,GAFD;AAGD,CAlBM","sourcesContent":["import axios from 'axios';\nimport { getLogger } from '../core';\nimport { CarProps } from './CarProps';\n\nconst log = getLogger('stockApi');\n\nconst baseUrl = 'localhost:3000';\nconst carsUrl = `http://${baseUrl}/car`;\n\ninterface ResponseProps<T> {\n  data: T;\n}\n\nfunction withLogs<T>(promise: Promise<ResponseProps<T>>, fnName: string): Promise<T> {\n  log(`${fnName} - started`);\n  return promise\n    .then(res => {\n      log(`${fnName} - succeeded`);\n      return Promise.resolve(res.data);\n    })\n    .catch(err => {\n      log(`${fnName} - failed`);\n      return Promise.reject(err);\n    });\n}\n\nconst config = {\n  headers: {\n    'Content-Type': 'application/json'\n  }\n};\n\nexport const getCars: () => Promise<CarProps[]> = () => {\n  return withLogs(axios.get(carsUrl, config), 'getCars');\n}\n\nexport const createCar: (stock: CarProps) => Promise<CarProps[]> = stock => {\n  return withLogs(axios.post(carsUrl, stock, config), 'createCar');\n}\n\nexport const updateCar: (stock: CarProps) => Promise<CarProps[]> = stock => {\n  return withLogs(axios.put(`${carsUrl}/${stock.id}`, stock, config), 'updateCar');\n}\n\ninterface MessageData {\n  event: string;\n  payload: {\n      car: CarProps;\n  };\n}\n\nexport const newWebSocket = (onMessage: (data: MessageData) => void) => {\n  const ws = new WebSocket(`ws://${baseUrl}`)\n  ws.onopen = () => {\n    log('web socket onopen');\n  };\n  ws.onclose = () => {\n    log('web socket onclose');\n  };\n  ws.onerror = error => {\n    log('web socket onerror', error);\n  };\n  ws.onmessage = messageEvent => {\n    log('web socket onmessage');\n    onMessage(JSON.parse(messageEvent.data));\n  };\n  return () => {\n    ws.close();\n  }\n}\n"]},"metadata":{},"sourceType":"module"}