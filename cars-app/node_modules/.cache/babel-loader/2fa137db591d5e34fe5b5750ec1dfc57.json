{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Andrei Gabor\\\\Desktop\\\\UNI\\\\3rd YEAR\\\\Mobile\\\\filip\\\\stocks-app\\\\src\\\\cars\\\\StockProvider.tsx\";\nimport React, { useCallback, useEffect, useReducer } from 'react';\nimport { getLogger } from '../core';\nimport { createCar, getCars, newWebSocket, updateCar } from './StockApi';\nconst log = getLogger('StockProvider');\nconst initialState = {\n  fetching: false,\n  saving: false\n};\nconst FETCH_CARS_STARTED = 'FETCH_CARS_STARTED';\nconst FETCH_CARS_SUCCEEDED = 'FETCH_CARS_SUCCEEDED';\nconst FETCH_CARS_FAILED = 'FETCH_CARS_FAILED';\nconst SAVE_CAR_STARTED = 'SAVE_CAR_STARTED';\nconst SAVE_CAR_SUCCEEDED = 'SAVE_CAR_SUCCEEDED';\nconst SAVE_CAR_FAILED = 'SAVE_CAR_FAILED';\n\nconst reducer = (state, {\n  type,\n  payload\n}) => {\n  switch (type) {\n    case FETCH_CARS_STARTED:\n      return { ...state,\n        fetching: true,\n        fetchingError: null\n      };\n\n    case FETCH_CARS_SUCCEEDED:\n      return { ...state,\n        cars: payload.stocks,\n        fetching: false\n      };\n\n    case FETCH_CARS_FAILED:\n      return { ...state,\n        fetchingError: payload.error,\n        fetching: false\n      };\n\n    case SAVE_CAR_STARTED:\n      return { ...state,\n        savingError: null,\n        saving: true\n      };\n\n    case SAVE_CAR_SUCCEEDED:\n      const cars = [...(state.cars || [])];\n      const car = payload.car;\n      const index = cars.findIndex(it => it.id === car.id);\n\n      if (index === -1) {\n        cars.splice(0, 0, car);\n      } else {\n        cars[index] = car;\n      }\n\n      return { ...state,\n        cars: cars,\n        saving: false\n      };\n\n    case SAVE_CAR_FAILED:\n      return { ...state,\n        savingError: payload.error,\n        saving: false\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport const CarContext = React.createContext(initialState);\nexport const StockProvider = ({\n  children\n}) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const {\n    stocks,\n    fetching,\n    fetchingError,\n    saving,\n    savingError\n  } = state;\n  useEffect(getStocksEffect, []);\n  useEffect(wsEffect, []);\n  const saveStock = useCallback(saveStockCallback, []);\n  const value = {\n    stocks,\n    fetching,\n    fetchingError,\n    saving,\n    savingError,\n    saveStock\n  };\n  log('returns');\n  return /*#__PURE__*/React.createElement(CarContext.Provider, {\n    value: value,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 9\n    }\n  }, children);\n\n  function getStocksEffect() {\n    let canceled = false;\n    fetchStocks();\n    return () => {\n      canceled = true;\n    };\n\n    async function fetchStocks() {\n      try {\n        log('fetchStocks started');\n        dispatch({\n          type: FETCH_STOCKS_STARTED\n        });\n        const stocks = await getCars();\n        log('fetchStocks succeeded');\n\n        if (!canceled) {\n          dispatch({\n            type: FETCH_STOCKS_SUCCEEDED,\n            payload: {\n              stocks\n            }\n          });\n        }\n      } catch (error) {\n        log('fetchStocks failed');\n        dispatch({\n          type: FETCH_STOCKS_FAILED,\n          payload: {\n            error\n          }\n        });\n      }\n    }\n  }\n\n  async function saveStockCallback(stock) {\n    try {\n      log('saveStock started');\n      dispatch({\n        type: SAVE_STOCK_STARTED\n      });\n      const savedStock = await (stock.id ? updateCar(stock) : createCar(stock));\n      log('saveStock succeeded');\n      dispatch({\n        type: SAVE_STOCK_SUCCEEDED,\n        payload: {\n          stock: savedStock\n        }\n      });\n    } catch (error) {\n      log('saveStock failed');\n      dispatch({\n        type: SAVE_STOCK_FAILED,\n        payload: {\n          error\n        }\n      });\n    }\n  }\n\n  function wsEffect() {\n    let canceled = false;\n    log('wsEffect - connecting');\n    const closeWebSocket = newWebSocket(message => {\n      if (canceled) {\n        return;\n      }\n\n      const {\n        event,\n        payload: {\n          car\n        }\n      } = message;\n      log(`ws message, stock ${event}`);\n\n      if (event === 'created' || event === 'updated') {\n        dispatch({\n          type: SAVE_STOCK_SUCCEEDED,\n          payload: {\n            car: car\n          }\n        });\n      }\n    });\n    return () => {\n      log('wsEffect - disconnecting');\n      canceled = true;\n      closeWebSocket();\n    };\n  }\n};","map":{"version":3,"sources":["C:/Users/Andrei Gabor/Desktop/UNI/3rd YEAR/Mobile/filip/stocks-app/src/cars/StockProvider.tsx"],"names":["React","useCallback","useEffect","useReducer","getLogger","createCar","getCars","newWebSocket","updateCar","log","initialState","fetching","saving","FETCH_CARS_STARTED","FETCH_CARS_SUCCEEDED","FETCH_CARS_FAILED","SAVE_CAR_STARTED","SAVE_CAR_SUCCEEDED","SAVE_CAR_FAILED","reducer","state","type","payload","fetchingError","cars","stocks","error","savingError","car","index","findIndex","it","id","splice","CarContext","createContext","StockProvider","children","dispatch","getStocksEffect","wsEffect","saveStock","saveStockCallback","value","canceled","fetchStocks","FETCH_STOCKS_STARTED","FETCH_STOCKS_SUCCEEDED","FETCH_STOCKS_FAILED","stock","SAVE_STOCK_STARTED","savedStock","SAVE_STOCK_SUCCEEDED","SAVE_STOCK_FAILED","closeWebSocket","message","event"],"mappings":"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","sourcesContent":["import React, {useCallback, useEffect, useReducer} from 'react';\nimport PropTypes from 'prop-types';\nimport {getLogger} from '../core';\nimport {CarProps} from './CarProps';\nimport {createCar, getCars, newWebSocket, updateCar} from './StockApi';\n\nconst log = getLogger('StockProvider');\n\ntype SaveCarFn = (stock: CarProps) => Promise<any>;\n\nexport interface CarsState {\n    cars?: CarProps[],\n    fetching: boolean,\n    fetchingError?: Error | null,\n    saving: boolean,\n    savingError?: Error | null,\n    saveCar?: SaveCarFn,\n}\n\ninterface ActionProps {\n    type: string,\n    payload?: any,\n}\n\nconst initialState: CarsState = {\n    fetching: false,\n    saving: false,\n};\n\nconst FETCH_CARS_STARTED = 'FETCH_CARS_STARTED';\nconst FETCH_CARS_SUCCEEDED = 'FETCH_CARS_SUCCEEDED';\nconst FETCH_CARS_FAILED = 'FETCH_CARS_FAILED';\nconst SAVE_CAR_STARTED = 'SAVE_CAR_STARTED';\nconst SAVE_CAR_SUCCEEDED = 'SAVE_CAR_SUCCEEDED';\nconst SAVE_CAR_FAILED = 'SAVE_CAR_FAILED';\n\nconst reducer: (state: CarsState, action: ActionProps) => CarsState =\n    (state, {type, payload}) => {\n        switch (type) {\n            case FETCH_CARS_STARTED:\n                return {...state, fetching: true, fetchingError: null};\n            case FETCH_CARS_SUCCEEDED:\n                return {...state, cars: payload.stocks, fetching: false};\n            case FETCH_CARS_FAILED:\n                return {...state, fetchingError: payload.error, fetching: false};\n            case SAVE_CAR_STARTED:\n                return {...state, savingError: null, saving: true};\n            case SAVE_CAR_SUCCEEDED:\n                const cars = [...(state.cars || [])];\n                const car = payload.car;\n                const index = cars.findIndex(it => it.id === car.id);\n                if (index === -1) {\n                    cars.splice(0, 0, car);\n                } else {\n                    cars[index] = car;\n                }\n                return {...state, cars: cars, saving: false};\n            case SAVE_CAR_FAILED:\n                return {...state, savingError: payload.error, saving: false};\n            default:\n                return state;\n        }\n    };\n\nexport const CarContext = React.createContext<CarsState>(initialState);\n\ninterface CarProviderProps {\n    children: PropTypes.ReactNodeLike,\n}\n\nexport const StockProvider: React.FC<CarProviderProps> = ({children}) => {\n    const [state, dispatch] = useReducer(reducer, initialState);\n    const {stocks, fetching, fetchingError, saving, savingError} = state;\n    useEffect(getStocksEffect, []);\n    useEffect(wsEffect, []);\n    const saveStock = useCallback<SaveCarFn>(saveStockCallback, []);\n    const value = {stocks, fetching, fetchingError, saving, savingError, saveStock};\n    log('returns');\n    return (\n        <CarContext.Provider value={value}>\n            {children}\n        </CarContext.Provider>\n    );\n\n    function getStocksEffect() {\n        let canceled = false;\n        fetchStocks();\n        return () => {\n            canceled = true;\n        }\n\n        async function fetchStocks() {\n            try {\n                log('fetchStocks started');\n                dispatch({type: FETCH_STOCKS_STARTED});\n                const stocks = await getCars();\n                log('fetchStocks succeeded');\n                if (!canceled) {\n                    dispatch({type: FETCH_STOCKS_SUCCEEDED, payload: {stocks}});\n                }\n            } catch (error) {\n                log('fetchStocks failed');\n                dispatch({type: FETCH_STOCKS_FAILED, payload: {error}});\n            }\n        }\n    }\n\n    async function saveStockCallback(stock: CarProps) {\n        try {\n            log('saveStock started');\n            dispatch({type: SAVE_STOCK_STARTED});\n            const savedStock = await (stock.id ? updateCar(stock) : createCar(stock));\n            log('saveStock succeeded');\n            dispatch({type: SAVE_STOCK_SUCCEEDED, payload: {stock: savedStock}});\n        } catch (error) {\n            log('saveStock failed');\n            dispatch({type: SAVE_STOCK_FAILED, payload: {error}});\n        }\n    }\n\n    function wsEffect() {\n        let canceled = false;\n        log('wsEffect - connecting');\n        const closeWebSocket = newWebSocket(message => {\n            if (canceled) {\n                return;\n            }\n            const {event, payload: {car}} = message;\n            log(`ws message, stock ${event}`);\n            if (event === 'created' || event === 'updated') {\n                dispatch({type: SAVE_STOCK_SUCCEEDED, payload: {car: car}});\n            }\n        });\n        return () => {\n            log('wsEffect - disconnecting');\n            canceled = true;\n            closeWebSocket();\n        }\n    }\n};\n"]},"metadata":{},"sourceType":"module"}